(function(){angular.module("ngLuminateUtils",[]).constant("APP_INFO",{version:"0.7.1"}),angular.module("ngLuminateUtils").provider("$luminateUtilsConfig",function(){var a;(a=this).setPath=function(e){var t,n;return null==e&&(e={}),angular.isString(e.nonsecure)&&angular.isString(e.secure)?(e.nonsecure=e.nonsecure.toLowerCase(),e.secure=e.secure.toLowerCase(),t=e.nonsecure.indexOf("/site/")===e.nonsecure.length-6||e.nonsecure.indexOf("/admin/")===e.nonsecure.length-7,n=e.secure.indexOf("/site/")===e.secure.length-6||e.secure.indexOf("/admin/")===e.secure.length-7,t&&n?a.path={nonsecure:e.nonsecure,secure:e.secure}:(t||new Error("Invalid nonsecure path."),n||new Error("Invalid secure path."))):new Error("You must specify both a nonsecure and secure path."),a},a.setKey=function(e){return angular.isString(e)?a.apiKey=e:new Error("API Key must be a string but was "+typeof e),a},a.setLocale=function(e){return angular.isString(e)?"en_US"!==e&&"es_US"!==e&&"en_CA"!==e&&"fr_CA"!==e&&"en_GB"!==e&&"en_AU"!==e||(a.locale=e):new Error("Locale must be a string but was "+typeof e),a},a.setDefaultRequestData=function(e){return angular.isString(e)?a.defaultRequestData=e:new Error("Request data must be a string but was "+typeof e),a},a.$get=function(){return a}}),angular.module("ngLuminateUtils").factory("$luminateMessageCatalog",["$q","$luminateUtilsConfig","$luminateRequestHandler","$luminateRest",function(t,n,c,d){return{get:function(e){var u,r,s,i,o,l,g;return u=this,s=n.locale||"default",angular.isString(e)||angular.isArray(e)?(angular.isArray(e)||(e=[e]),r={},l=0,angular.forEach(e,function(e){var t,n,a;return 2!==(a=e.split(":")).length?new Error("Invalid Message Catalog bundle/key pair "+e):(t=c.sanitizeString(a[0],!0,!0),n=c.sanitizeString(a[1],!0,!0),r[t]||(r[t]={},l++),r[t].requestedKeys||(r[t].requestedKeys=[]),r[t].requestedKeys.push(n),r[t].newKeys||(r[t].newKeys=[]),u.messageCatalogCache||(u.messageCatalogCache={}),u.messageCatalogCache[s]||(u.messageCatalogCache[s]={}),u.messageCatalogCache[s][t]||(u.messageCatalogCache[s][t]={}),angular.isString(u.messageCatalogCache[s][t][n])?void 0:r[t].newKeys.push(n))}),0===r.length?c.rejectInvalidRequest("No Message Catalog bundles defined."):(i=t.defer(),o=0,g={},angular.forEach(r,function(a,r){return g[r]={},angular.forEach(a.requestedKeys,function(e){if(u.messageCatalogCache[s][r][e])return g[r][e]=u.messageCatalogCache[s][r][e]}),0!==a.newKeys.length?d.request({api:"content",data:"method=getMessageBundle&bundle="+r+"&keys="+a.newKeys.join(","),requiresAuth:!0}).then(function(e){var t,n;if((t=null!=(n=e.data.getMessageBundleResponse)?n.values:void 0)?(angular.isArray(t)||(t=[t]),angular.forEach(t,function(e){var t;return 0===(t=e.value).indexOf("Message not found for key: ")&&(t=""),u.messageCatalogCache[s][r][e.key]=t,g[r][e.key]=t})):angular.forEach(a.newKeys,function(e){return u.messageCatalogCache[s][r][e]="",g[r][e]=""}),++o===l)return i.resolve(g)}):++o===l?i.resolve(g):void 0}),i.promise)):c.rejectInvalidRequest("Message Catalog entries must be a string or array but was "+typeof e)},flushCache:function(){return _this.messageCatalogCache={},_this}}}]),angular.module("ngLuminateUtils").factory("$luminateRequestHandler",["$q",function(n){return{sanitizeString:function(e,t,n){var a;return a=e,n||(a=angular.element("<div>"+a+"</div>").text()),t||(a=a.replace(/\[\[/g,"").replace(/\]\]/g,"").replace(/::/g,"")),a},rejectInvalidRequest:function(e){var t;return null==e&&(e="Invalid request."),(t=n.defer()).reject(e),t.promise}}}]),angular.module("ngLuminateUtils").factory("$luminateRest",["$http","$q","$timeout","APP_INFO","$luminateUtilsConfig","$luminateRequestHandler",function(p,u,h,v,C,y){return{getAuthToken:function(e,t){var r;return!(r=this).authToken||e?(r.authTokenPending=!0,"method=getLoginUrl",r.request({api:"cons",data:"method=getLoginUrl"}).then(function(e){var t,n,a;return r.routingId=null!=(t=e.data.getLoginUrlResponse)?t.routing_id:void 0,r.jsessionId=null!=(n=e.data.getLoginUrlResponse)?n.JSESSIONID:void 0,r.authToken=(null!=(a=e.data.getLoginUrlResponse)?a.token:void 0)||"",r.authTokenPending=!1,u.resolve(r.authToken)})):(r.authTokenPending=!1,u.resolve(r.authToken))},request:function(e){var n,t,a,r,u,s,i,o,l,g,c,d,f,m;return null==e&&(e={}),n=this,t=(f=e).api,o=f.data,l=f.formData,d=f.requiresAuth,m=f.useHTTP,a=f.contentType,a=l&&!a||"multipart/form-data"===(null!=a?a.split(";")[0]:void 0)?"multipart/form-data":"application/x-www-form-urlencoded; charset=UTF-8",C.path.nonsecure&&C.path.secure?C.apiKey?angular.isString(t)?("addressbook"!==(i=t.toLowerCase())&&"advocacy"!==i&&"cons"!==i&&"content"!==i&&"datasync"!==i&&"donation"!==i&&"group"!==i&&"orgevent"!==i&&"recurring"!==i&&"survey"!==i&&"teamraiser"!==i||(t=(t="CR"+t.toLowerCase().charAt(0).toUpperCase()+t.toLowerCase().slice(1).toLowerCase()+"API").replace("Addressbook","AddressBook").replace("Datasync","DataSync").replace("Orgevent","OrgEvent")),"CRAddressBookAPI"!==t&&"CRAdvocacyAPI"!==t&&"CRConsAPI"!==t&&"CRContentAPI"!==t&&"CRDataSyncAPI"!==t&&"CRDonationAPI"!==t&&"CRGroupAPI"!==t&&"CROrgEventAPI"!==t&&"CRRecurringAPI"!==t&&"CRSurveyAPI"!==t&&"CRTeamraiserAPI"!==t?y.rejectInvalidRequest("Invalid API servlet "+t):l&&!angular.isObject(l)?y.rejectInvalidRequest("Request formData must be an object but was "+typeof l):l||angular.isString(o)?(l&&!o&&(o=""),""!==o&&(o+="&"),r=-1!==("&"+(o+="v=1.0&response_format=json&suppress_response_codes=true&api_key="+C.apiKey)).indexOf("&method=getLoginUrl&"),u=-1!==("&"+o).indexOf("&method=login&"),s=-1!==("&"+o).indexOf("&method=logout&"),r||n.authToken?("CRDonation"!==t&&"CRTeamraiserAPI"!==t||(m=!1),c=m?C.path.nonsecure:C.path.secure,c+=t,n.routingId&&(c+=";jsessionid="+n.routingId),C.locale&&(o+="&s_locale="+C.locale),C.defaultRequestData&&(o+="&"+C.defaultRequestData),n.jsessionId&&(o+="&JSESSIONID="+n.jsessionId),d&&(o+="&auth="+n.authToken),(null!=v?v.version:void 0)&&(o+="&ng_luminate_utils="+v.version),o+="&ts="+(new Date).getTime(),l&&angular.forEach(o.split("&"),function(e){var t,n,a;return t=(n=e.split("="))[0],a=n[1]||"",l.append(t,a)}),g={method:"POST",url:c,data:l||o,headers:{"Content-Type":"multipart/form-data"===a?void 0:a},withCredentials:!0},"multipart/form-data"===a&&(g.transformRequest=angular.identity),p(g).then(function(e){var t;return t=e,u||s?n.getAuthToken(!0,m).then(function(){return t}):t})):n.authTokenPending?h(function(){return n.request(e)},250):n.getAuthToken(!1,m).then(function(){return n.request(e)})):y.rejectInvalidRequest("Request data must be a string but was "+typeof o)):y.rejectInvalidRequest("API servlet must be a string but was "+typeof t):y.rejectInvalidRequest("You must specify both an API Key."):y.rejectInvalidRequest("You must specify both a nonsecure and secure path.")}}}]),angular.module("ngLuminateUtils").factory("$luminateSessionVar",["$q","$luminateRequestHandler","$luminateTemplateTag",function(e,n,a){return{get:function(e){var t;return angular.isString(e)?(t="",t=0===(e=n.sanitizeString(e,!0)).indexOf("[[")&&e.lastIndexOf("]]")===e.length-2?"[[E80:"+e+"]]":"[[S80:"+e+"]]",a.parse(t).then(function(e){return n.sanitizeString(e,!0)})):n.rejectInvalidRequest("Session variable name must be a string but was "+typeof e)},set:function(e,t){return null==t&&(t=""),angular.isString(e)?!angular.isString(t)&&isNaN(t)?n.rejectInvalidRequest("Session variable value must be a string or number but was "+typeof t):(e=n.sanitizeString(e,!0,!0),t=n.sanitizeString(t,!0),a.parse("[[U1:"+e+"="+t+"]]")):n.rejectInvalidRequest("Session variable name must be a string but was "+typeof e)}}}]),angular.module("ngLuminateUtils").factory("$luminateTemplateTag",["$q","$luminateRequestHandler","$luminateRest",function(a,n,r){return{parse:function(e){var t;return null==e&&(e=""),angular.isString(e)?""===e?((t=a.defer()).resolve(""),t.promise):(e=n.sanitizeString(e,!0),r.request({api:"content",data:"method=getTagInfo&content="+e,requiresAuth:!0}).then(function(e){var t,n;return t=(null!=(n=e.data.getTagInfoResponse)?n.preview:void 0)||"",a.resolve(t)})):n.rejectInvalidRequest("Template tag must be a string but was "+typeof e)}}}]),angular.module("ngLuminateUtils").directive("luminateInclude",function(){return{scope:{filename:"="},template:'<div ng-bind-html="includeContent" ng-cloak></div>',replace:!0,controller:["$scope","$sce","$luminateRequestHandler","$luminateTemplateTag",function(n,a,r,u){var s;return(s=function(){var e,t;return e=n.filename,angular.isString(e)?(t="",t=-1<(e=r.sanitizeString(e,!0)).indexOf("[[")&&e.indexOf("]]")>e.indexOf("[[")?"[[E84:"+e+"]]":"[[S84:"+(e=r.sanitizeString(e))+"]]",u.parse(t).then(function(e){return n.includeContent=a.trustAsHtml(e)})):r.rejectInvalidRequest("Filename must be a string but was "+typeof e)})(),n.$watch("filename",function(e,t){if(e!==t)return s()})}]}}),angular.module("ngLuminateUtils").directive("luminateReusable",function(){return{scope:{pagename:"="},template:'<div ng-bind-html="reusableContent" ng-cloak></div>',replace:!0,controller:["$scope","$sce","$luminateRequestHandler","$luminateTemplateTag",function(n,a,r,u){var s;return(s=function(){var e,t;return e=n.pagename,angular.isString(e)?(t="",t=-1<(e=r.sanitizeString(e,!0)).indexOf("[[")&&e.indexOf("]]")>e.indexOf("[[")?"[[E51:"+e+"]]":"[[S51:"+(e=r.sanitizeString(e))+"]]",u.parse(t).then(function(e){return n.reusableContent=a.trustAsHtml(e)})):r.rejectInvalidRequest("Pagename must be a string but was "+typeof e)})(),n.$watch("pagename",function(e,t){if(e!==t)return s()})}]}})}).call(this);